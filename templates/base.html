<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  {% block head %}
  <title>{% block title %}PLC_dashboard{% endblock %}PLC_dashboard</title>
  {% endblock %}
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
  <link rel="stylesheet" href="/static/css/base.css">
  <link rel="stylesheet" href="/static/css/todayproduction.css">
  <link rel="stylesheet" href="/static/css/setting.css">
  <link rel="stylesheet" href="/static/css/delayreport.css">
  <link rel="stylesheet" href="/static/css/test-html.css">
  <link rel="stylesheet" href="/static/css/profilepage.css">
  <link rel="stylesheet" href="/static/css/submit_event_form.css">
  <link rel="stylesheet" href="/static/css/registration_login.css">
  <link rel="stylesheet" href="/static/css/admin.css">
  <link rel="stylesheet" href="/static/css/notification.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
  <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>
  <nav class="navbar navbar-custom sticky-top">
    <div class="container-fluid">
      <div class="nav-logo"><img src="/static/images/synergilogo.png" alt="Synergie Logo"></div>
      <div>
      <div class="container-fluid nav-link-last">
        {% if current_user.is_authenticated%}
        
        {% endif %}

      {% if current_user.is_authenticated%}
      <span style="color: #fff3cd; margin-right: 15px; font-size: 20px;">{{current_user.name}} - {{current_user.role}}</span> 
      
      <div class="notification" aria-disabled="true">
        <a href="/notification" ><span class="fas fa-bell notification-icon">

        </span></a><span class="notification-dot"></span>
      </div>

      <div class="auth-button">
       
      <a href="{{ url_for('logout') }}">Logout</a>
    </div>
  
      {% else %}

      <div class="auth-button">
      <a href="{{ url_for('login') }}">Login</a>
    </div>
    
    {% endif %}
   
    
      <div class="location"><i class="fa fa-map-marker" aria-hidden="true"></i> Mumbai</div>
    </div>
    </div>
    </div>
  </nav>

 

  <div class="btn-bar">
    <span class="fas fa-bars"></span>
  </div>
  <nav class="d-sidebar">
    <div class="text-sidebar">Menu</div>
    <ul class="ul">
      <li>
        <a class="feat-btn">Today
          <span class="fas fa-caret-down first"></span>
        </a>
        <ul class="feat-show">
          <li class="d-option"><a href="/">Today Runtime</a></li>
          <li class="d-option"><a href="shifta">Shift A</a></li>
          <li class="d-option"><a href="shiftb">Shift B</a></li>
        </ul>
      </li>
      <li>
        <a class="feat-btn">Yesterday
          <span class="fas fa-caret-down first"></span>
        </a>
        <ul class="feat-show">
          <li class="d-option"><a href="yesterday">Yesterday Summary</a></li>
          <li class="d-option"><a href="yesterdayshifta">Shift A</a></li>
          <li class="d-option"><a href="yesterdayshiftb">Shift B</a></li>
        </ul>
      </li>
      <li class="d-option"><a href="weeklyproduction">Week</a></li>
      <li class="d-option"><a href="monthlyproduction">Month</a></li>
    

        
        <!-- Conditional Menu Items Based on User Roles -->
        {% if 'admin' in current_user.role %}
        <li class="d-option"><a href="delayreport">Delay Report</a></li>
            <li class="d-option"><a href="unsubmitted_events">Unsubmitted Events</a></li>
            <li class="d-option"><a href="unapproved_events">Unapproved Events</a></li>
            <li class="d-option"><a href="rejected_events">Rejected Events</a></li>
            <li class="d-option"><a href="approved_events">Approved Events</a></li>
            <li class="d-option"><a href="admin">Admin Panel</a></li>
        {% elif 'operator' in current_user.role %}
            <li class="d-option"><a href="unsubmitted_events">Unsubmitted Events</a></li>
            <li class="d-option"><a href="unapproved_events">Unapproved Events</a></li>
            <li class="d-option"><a href="rejected_events">Rejected Events</a></li>
            <li class="d-option"><a href="approved_events">Approved Events</a></li>
        {% elif 'engineerarea1' in current_user.role or 'engineerarea2' in current_user.role or 'engineerarea3' in current_user.role %}         
            <li class="d-option"><a href="unapproved_events">Unapproved Events</a></li>
        {% elif 'electrichead' in current_user.role or 'mechanicalhead' in current_user.role or 'operationalhead' in current_user.role %}
            <li class="d-option"><a href="unapproved_events">Unapproved Events</a></li>
            <li class="d-option"><a href="rejected_events">Rejected Events</a></li>
            <li class="d-option"><a href="approved_events">Approved Events</a></li>
        {% elif 'planthead' in current_user.role %}

        <li class="d-option"><a href="delayreport">Delay Report</a></li>

        <li class="d-option"><a href="unsubmitted_events">Unsubmitted Events</a></li>
        <li class="d-option"><a href="unapproved_events">Unapproved Events</a></li>
        <li class="d-option"><a href="rejected_events">Rejected Events</a></li>
        <li class="d-option"><a href="approved_events">Approved Events</a></li>

        {% endif %}
        
      
        
      
      <li>
        <hr class="sidebar-divider">
        <div class="d-sidebar-footer">
          <div class="setting" aria-disabled="true">
            <a href="setting" ><span class="fas fa-cog fa-spin " style="font-size:24px"></span></a>
          </div>
          <div class="profile">
            <a href="userprofile"><span class="fas fa-user"></span></a>
          </div>
        </div>
      </li>
    </ul>
  </nav>


  {% with msg = get_flashed_messages() %}
  {% if msg %}
    {% for message in msg %}
      <div style="padding-left: 10%; " class="alert alert-warning alert-dismissible fade show" role="alert">
        <strong>{{ message }}</strong>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}
{% endwith %}


  {% block content %}
  {% endblock %}

  <div class="footer">
    <p>&copy; 2024 Synergie Controls and System Pvt Ltd, Navi Mumbai. All rights reserved.</p>
  </div>

  <div class="levitate-body">
    <div class="levitate">
      <div class="logo">
        <span class="h">Feedback</span>
      </div>
    </div>
  </div>


  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
<script>  

   //javascript for pop up ------------------------------------
  // Select elements
  const responsibleDepartment = document.getElementById("responsibleDepartment");
  const reason = document.getElementById("reason");
  const reasonInputContainer = document.getElementById("reasonInputContainer");
  const reasonInput = document.getElementById("reasonInput");
  const myPopup = document.getElementById("myPopup");
  const closePopup = document.getElementById("closePopup");


// pop up update reasons --------------------------------------------------------

  // Reasons data based on department
  const reasons = {
      mechanical: [
          "Guide Box Fail",
          "Bearing Fail",
          "Mis-alignment of Pass",
          "Other"
      ],
      electrical: [
          "Drive Trip",
          "Shear Not Taken Out",
          "Other"
      ],
      operational: [
          "Pass change",
          "Stunt change",
          "Section Change",
          "Size Setting",
          "Other"
      ],
      other: [
          "Power Dip",
          "Power Fail",
          "Voltage Fluctuation",
          "Other"
      ]
  };

  // Function to update reason dropdown
  function updateReasons() {
      const selectedDepartment = responsibleDepartment.value;
      const options = reasons[selectedDepartment] || [];

      // Reset the options and add the default option
      reason.innerHTML = '<option value="">Select Reason</option>';

      // Create and append new options
      options.forEach(reasonOption => {
          const optionElement = document.createElement("option");
          optionElement.value = reasonOption;
          optionElement.textContent = reasonOption;
          reason.appendChild(optionElement);
      });

      // Hide the reason input initially
      reasonInputContainer.style.display = "none";
  }

  // Add event listener for department dropdown change
  responsibleDepartment.addEventListener("change", updateReasons);

  // Add event listener for reason dropdown change
  reason.addEventListener("change", function() {
      if (reason.value === "Other") {
          reasonInputContainer.style.display = "block";
      } else {
          reasonInputContainer.style.display = "none";
      }
  });






  // Remove pop up after clicking close button
  closePopup.addEventListener("click", function() {
      myPopup.classList.remove("show");
  });

  const socket = io();

  socket.on('new_event', function(data) {
      // Update the popup content with the received data
      document.getElementById("eventName").textContent = data.event_name;
      document.getElementById("eventArea").textContent = data.event_area;
      document.getElementById("eventTimeStart").textContent = data.event_start;
      document.getElementById("eventTimeStop").textContent = data.event_stop;
      document.getElementById("delayTime").textContent = data.time_delay;
      myPopup.classList.add("show");  // Display the popup
  });
</script>

<!-- pop-script-end  -------------------------------------->


  <script>



    document.addEventListener("DOMContentLoaded", function () {
      // Sidebar toggle button functionality
      document.querySelector('.btn-bar').addEventListener('click', function() {
        this.classList.toggle("click");
        document.querySelector('.d-sidebar').classList.toggle("show");
      });

      // Dropdown button functionality
      document.querySelectorAll('.feat-btn').forEach(function(button){
        button.addEventListener('click', function(){
          this.nextElementSibling.classList.toggle("show");
          this.querySelector('.first').classList.toggle("rotate");
        });
      });

      // Active class functionality for sidebar options
      document.querySelectorAll('.d-option').forEach(function(item){
        item.addEventListener('click', function(){
          document.querySelectorAll('.d-option').forEach(function(element){
            element.classList.remove("active");
          });
          this.classList.add("active");
        });
      });

      // Hide sidebar after clicking anywhere outside
      document.addEventListener('click', function(event){
        const sidebar = document.querySelector('.d-sidebar');
        const btn = document.querySelector('.btn-bar');
        if (!sidebar.contains(event.target) && !btn.contains(event.target)){
          sidebar.classList.remove("show");
          btn.classList.remove("click");
        }
      });

      // Sidebar and footer toggle functionality using jQuery
      $(document).ready(function() {
        $(".btn-bar").click(function() {
          $(".d-sidebar").toggleClass("open");
          $(".d-sidebar-footer").toggleClass("show");
        });
      });

      // Update current date and time
      function updateDateTime() {
        const currentdate = document.getElementById('currentdate');
        const now = new Date();
        const months = ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC'];
        const month = months[now.getMonth()];
        const date = now.getDate();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const seconds = now.getSeconds();
        const dateTimeString = `${date} ${month} ${hours < 10 ? '0' : ''}${hours}:${minutes < 10 ? '0' : ''}${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;
        currentdate.textContent = dateTimeString;
      }

      updateDateTime();
      setInterval(updateDateTime, 1000);
    });

    // Dashboard ratings animation
    const rating = document.getElementsByClassName('rating')[0];
    const block = document.getElementsByClassName('block');
    const timePercentage = Math.floor((hoursPassed() / 24) * 100);
    for (var i = 0; i < 100; i++) {
      rating.innerHTML += "<div class='block'></div>";
      block[i].style.transform = "rotate(" + (3.6 * i) + "deg)";
      block[i].style.animationDelay = `${i / 100}s`;
      if (i < timePercentage) {
        block[i].classList.add('highlight');
      }
    }

    // Calculate total hours passed
    function hoursPassed() {
      let currentTime = new Date();
      let startTime = new Date();
      startTime.setHours(0);
      startTime.setMinutes(0);
      startTime.setSeconds(0);
      startTime.setMilliseconds(0);
      let timeDifference = currentTime - startTime;
      var hours = Math.floor(timeDifference / (1000 * 60 * 60));
      return hours;
    }

    // Update HTML content with total hours passed
    document.addEventListener("DOMContentLoaded", function () {
      var hours = hoursPassed();
      var timePassedElements = document.querySelectorAll(".total-time");
      timePassedElements.forEach(function (element) {
        element.textContent = hours + " hrs";
      });
    });
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
